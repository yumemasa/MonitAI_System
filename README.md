# MonitAI System (モニタイ・システム)

## 概要
MonitAI System は、PC作業中の生産性を向上させるために開発された、AI搭載型の自己管理・監視アプリケーションです。
定期的にデスクトップ画面をキャプチャし、Google Gemini (マルチモーダルAI) を用いてユーザーの行動を解析。ユーザーが定めたルールに違反していないかをリアルタイムで判定します。

違反が検知されると、ポイントシステムに基づいて段階的に「介入 (Intervention)」が行われます。最初は警告のみですが、改善が見られない場合は画面のグレースケール化、入力遅延、最終的には強制シャットダウンといった強力なペナルティが課され、ユーザーを作業に引き戻します。

## 特徴
*   **AIによる高度な画像認識**: Gemini API または Gemini CLI を利用し、画面上のテキストだけでなく、ウィンドウの状態やコンテンツの内容（YouTubeを見ている、ゲームをしている等）を具体的に認識・判定します。
*   **段階的な介入システム (Intervention)**:
    *   Lv1: 警告通知
    *   Lv2: 画面のグレースケール化（色彩を奪い、ドーパミン刺激を抑制）
    *   Lv3: 入力遅延・マウス反転（操作性を下げ、遊びにくくする）
    *   Lv4: 警告音（Beep）
    *   Lv5: 強制画面ロック
    *   Lv6: 強制シャットダウン
*   **ハイブリッド動作モード**:
    *   **APIモード**: Google Gemini APIキーを使用（手軽、推奨）。
    *   **CLI/ACPモード**: ローカル環境のGemini CLIを活用（上級者向け、Node.jsが必要）。

## 動作環境
*   **OS**: Windows 10 または Windows 11 (64bit)
*   **必須ランタイム**: .NET 8.0 Desktop Runtime

## セットアップ手順

### 1. アプリケーションのビルド
本リポジトリをVisual Studio 2022等で開き、ソリューション (`MonitAI_System.sln`) をビルドしてください。  
またはコマンドラインから以下のコマンドを実行します:
```powershell
dotnet build
```

### 2. APIモードを使用する場合
Google AI Studio 等から **Gemini API Key** を取得してください。
起動後の設定画面でAPIキーを入力するだけで利用可能です。特別な環境構築は不要です。

### 3. (上級者向け) CLI/ACPモードを使用する場合
APIキーを使用せず、ローカル環境の Node.js および Gemini CLI を利用する場合の手順です。

1.  **Node.js のインストール**: 公式サイトから Node.js (LTS推奨) をインストールしてください。
2.  **Gemini CLI のインストール**:
    ターミナル（PowerShell等）で以下のコマンドを実行し、Gemini CLIをグローバルインストールします。
    ```powershell
    npm install -g @google/gemini-cli
    ```
    > **注意**: 
    > *   CLIモードを使用する場合、npmのインストール先（グローバルパス）によってはアプリがCLIを見つけられない場合があります。
    > *   その場合は、設定画面（Settings）の**「高度な設定」**にて、`gemini.cmd` のパスや ACP用スクリプト（`index.js`）のパスを直接指定してください。

### 4. Windowsサービスのセットアップ (必須)
本システムを正常に動作させるには、**MonitAI Service** の登録と起動が必須です。
※本来はリリース版のインストーラーが自動的に行う処理ですが、開発環境や手動インストールの場合は以下の手順でサービスを起動する必要があります。

詳しいコマンドや手順については、リポジトリ内の以下のファイルを参照してください：
`MonitAIサービス完成版\MonitAI_Service\MonitAI_serviceの開始停止方法.txt`

**サービスの役割:**
*   システムの監視と保護
*   強制的な介入（ロック、シャットダウン等）の実行
*   ユーザーによる不正なプロセス終了の防止

## 使い方

1.  **起動**:
    ビルド後、以下の実行ファイルを起動します。
    `MonitAI.UI\bin\Debug\net8.0-windows\MonitAI.UI.exe`
    
    ※ `MonitAI.Agent.exe` はバックグラウンド常駐用のプロセスですが、通常はUIから自動的に起動されます。

2.  **初期設定**:
    *   **API Key**: 前述の手順で取得したキーを入力（APIモードの場合）。
    *   **User Rules (ルール)**: 「勉強以外のサイトを見ない」「YouTube禁止」など、AIに守らせたいルールを自然言語で記述します。
    *   **Model**: 使用するAIモデルを選択します（`gemini-2.5-flash` 等）。※CLIモード時はCLI側のデフォルトが優先される場合があります。
    *   **高度な設定 (Advanced)**: CLI/ACPモード時のパスを手動設定する場合に使用します（通常は空欄で構いません）。

3.  **監視開始**:
    *   設定を保存し、「監視開始」ボタン（またはセットアップ完了）を押すと、タスクトレイに常駐し監視が始まります。
    *   定期的にスクリーンショットが解析され、違反があればポイント、ペナルティレベルが上昇します。


## データ保存場所
ログファイルや設定データは以下のフォルダに保存されます。
`%APPDATA%\screenShot2\` 

## 構成プロジェクト
*   **MonitAI.UI**: ユーザー設定、状態表示を行うWPFアプリケーション。
*   **MonitAI.Agent**: 画面キャプチャ、AI解析、介入処理を行うバックグラウンドプロセス。
*   **MonitAI.Core**: 共通ロジックライブラリ。

## 免責事項・注意
本アプリケーションは「強制シャットダウン」や「入力操作の妨害」など、ユーザーのPC操作に強力に干渉する機能を含みます。
重要なデータの編集中や、予期せぬシャットダウンが許されない状況での使用には十分ご注意ください。本アプリの使用によって生じたデータの損失や損害について、開発者は責任を負いかねます。

## ACP（Agent-Client Protocol）について

**ACP（Agent-Client Protocol）**は、Google Gemini CLIに2024年以降追加された比較的新しい技術です。
従来の「コマンドごとに毎回プロセスを起動してAIに問い合わせる」方式ではなく、
**Node.js上でAIエージェント（Gemini）を常駐プロセスとして起動し、アプリと双方向通信（JSON-RPC）でやりとりする仕組み**です。

### 特徴・ポイント
- **高速・省リソース**：プロセスを毎回起動せず、常駐したまま複数回の解析や会話ができる。
- **双方向通信**：アプリから「画像解析して」とリクエストし、AIから逐次応答や進捗通知を受け取れる。
- **CLIの新機能**：Gemini CLIの `--experimental-acp` オプションで有効化。2024年以降のバージョンでサポート。
- **用途**：大量の画像解析や、連続したAI対話が必要なアプリ・サービスで特に有効。

> 簡単に言うと「AIを裏でずっと起動しておき、アプリとリアルタイムでやりとりできる最新の仕組み」です。
> 従来のCLIよりも応答が速く、連続利用に向いています。
