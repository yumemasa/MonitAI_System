<UserControl x:Class="layoutsample.Features.MonitoringOverlay.MonitoringOverlay"
    xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
    xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
    xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
    xmlns:ui="http://schemas.lepo.co/wpfui/2022/xaml"
    mc:Ignorable="d"
    d:DesignHeight="760" d:DesignWidth="1000">

    <UserControl.Resources>
        <SolidColorBrush x:Key="MonitoringBackgroundBrush" Color="#202020"/>
        <SolidColorBrush x:Key="MonitoringTextPrimaryBrush" Color="White"/>
        <SolidColorBrush x:Key="MonitoringTextSecondaryBrush" Color="#C8C8C8"/>
        <SolidColorBrush x:Key="MonitoringTextTertiaryBrush" Color="#808080"/>
        <SolidColorBrush x:Key="MonitoringControlSecondaryBrush" Color="#19FFFFFF"/>
        <SolidColorBrush x:Key="MonitoringSolidBackgroundBrush" Color="#2D2D2D"/>
        <SolidColorBrush x:Key="MonitoringSurfaceStrokeBrush" Color="#404040"/>
        <SolidColorBrush x:Key="MonitoringAccentBrush" Color="#60CDFF"/>
    </UserControl.Resources>

    <Grid x:Name="RootGrid" Background="{StaticResource MonitoringBackgroundBrush}">
        <Grid x:Name="NormalMonitorLayout">
            <Grid.RowDefinitions>
                <RowDefinition Height="40"/>
                <RowDefinition Height="*"/>
                <RowDefinition Height="Auto"/>
            </Grid.RowDefinitions>

            <Grid Grid.Row="1" HorizontalAlignment="Center">
                <Grid.ColumnDefinitions>
                    <ColumnDefinition Width="Auto"/>
                    <ColumnDefinition Width="Auto"/>
                </Grid.ColumnDefinitions>

                <Viewbox Grid.Column="0" Margin="0,40,40,40">
                    <Grid x:Name="MonitorContainer" Width="400" Height="400" RenderTransformOrigin="0.5,0.5">
                        <Grid.RenderTransform>
                            <TranslateTransform X="0" Y="0"/>
                        </Grid.RenderTransform>

                        <Grid Width="330" Height="330" HorizontalAlignment="Center" VerticalAlignment="Center">
                            <Grid.Clip>
                                <EllipseGeometry Center="165,165" RadiusX="165" RadiusY="165"/>
                            </Grid.Clip>
                            <Border Background="{StaticResource MonitoringSolidBackgroundBrush}" />
                            <Border x:Name="LiquidWater" 
                                    Height="330" Width="330"
                                    VerticalAlignment="Bottom"
                                    RenderTransformOrigin="0.5, 1">
                                <Border.RenderTransform>
                                    <ScaleTransform x:Name="LiquidScaleTransform" ScaleY="0" />
                                </Border.RenderTransform>
                            </Border>
                        </Grid>

                        <Path x:Name="ArcPath" Stroke="{StaticResource MonitoringAccentBrush}" StrokeThickness="20" StrokeEndLineCap="Round">
                            <Path.Data>
                                <PathGeometry>
                                    <PathFigure x:Name="ArcFigure" StartPoint="200,10">
                                        <ArcSegment x:Name="ArcSegment" Point="200,10" 
                                                    Size="190,190"
                                                    IsLargeArc="False"
                                                    SweepDirection="Clockwise" />
                                    </PathFigure>
                                </PathGeometry>
                            </Path.Data>
                        </Path>

                        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center">
                            <Border Background="#40000000" CornerRadius="12" Padding="12,4" HorizontalAlignment="Center" Margin="0,0,0,10">
                                <TextBlock x:Name="CurrentLevelText" 
                                           FontWeight="Bold" Foreground="{StaticResource MonitoringTextPrimaryBrush}" FontSize="18">
                                    <TextBlock.Effect>
                                        <DropShadowEffect Color="Black" BlurRadius="6" ShadowDepth="1" Opacity="0.8"/>
                                    </TextBlock.Effect>
                                </TextBlock>
                            </Border>

                            <TextBlock x:Name="TimeDisplay" FontSize="84" FontWeight="Bold" 
                                       HorizontalAlignment="Center" Foreground="{StaticResource MonitoringTextPrimaryBrush}"
                                       FontFamily="Segoe UI Variable Display"
                                       Margin="0,0,0,10">
                                <TextBlock.Effect>
                                    <DropShadowEffect Color="Black" BlurRadius="10" ShadowDepth="2" Opacity="0.6"/>
                                </TextBlock.Effect>
                            </TextBlock>

                            <Border Background="#40000000" CornerRadius="12" Padding="16,6" HorizontalAlignment="Center">
                                <StackPanel Orientation="Horizontal">
                                    <ui:SymbolIcon x:Name="NextPenaltyIconControl" Symbol="Alert24" FontSize="26" Foreground="{StaticResource MonitoringTextPrimaryBrush}" Margin="0,0,10,0">
                                        <ui:SymbolIcon.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.8"/>
                                        </ui:SymbolIcon.Effect>
                                    </ui:SymbolIcon>

                                    <TextBlock x:Name="NextPenaltyNameText" FontSize="22" FontWeight="Medium" Foreground="{StaticResource MonitoringTextPrimaryBrush}" VerticalAlignment="Center">
                                        <TextBlock.Effect>
                                            <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.8"/>
                                        </TextBlock.Effect>
                                    </TextBlock>
                                </StackPanel>
                            </Border>
                        </StackPanel>
                    </Grid>
                </Viewbox>

                <StackPanel Grid.Column="1" VerticalAlignment="Center" MaxWidth="420" x:Name="InfoPanel"
                            HorizontalAlignment="Left">

                    <Border Background="#CC000000" CornerRadius="8" Padding="16,10" Margin="0,0,0,12">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <ui:SymbolIcon Grid.Column="0" Symbol="Flag24" FontSize="18" Margin="0,2,12,0" VerticalAlignment="Top" Foreground="{StaticResource MonitoringAccentBrush}"/>

                            <TextBlock Grid.Column="1" x:Name="GoalText"
                                       FontSize="15" FontWeight="Bold" Foreground="{StaticResource MonitoringTextPrimaryBrush}" 
                                       TextWrapping="Wrap" 
                                       LineHeight="20" MaxHeight="100"/>
                        </Grid>
                    </Border>

                    <Border x:Name="NgBorder" Background="#CC000000" CornerRadius="8" Padding="16,10">
                        <Grid>
                            <Grid.ColumnDefinitions>
                                <ColumnDefinition Width="Auto"/>
                                <ColumnDefinition Width="*"/>
                            </Grid.ColumnDefinitions>
                            <ui:SymbolIcon Grid.Column="0" Symbol="Prohibited20" FontSize="16" Margin="0,2,12,0" VerticalAlignment="Top" Foreground="#FF6666"/>

                            <TextBlock Grid.Column="1" x:Name="NgText"
                                       FontSize="13" Foreground="{StaticResource MonitoringTextSecondaryBrush}" 
                                       TextWrapping="Wrap" 
                                       LineHeight="18" MaxHeight="90"/>
                        </Grid>
                    </Border>
                </StackPanel>
            </Grid>

            <Border Grid.Row="2" Background="{StaticResource MonitoringSolidBackgroundBrush}" 
                    Padding="20,16" Margin="24" CornerRadius="8" BorderBrush="{StaticResource MonitoringSurfaceStrokeBrush}" BorderThickness="1">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="*"/>
                        <ColumnDefinition Width="Auto"/>
                    </Grid.ColumnDefinitions>

                    <StackPanel VerticalAlignment="Center">
                        <TextBlock x:Name="StatusText" Text="MONITORING ACTIVE" FontSize="12" FontWeight="Bold"/>
                        <TextBlock Text="集中力を維持してください" FontSize="12" Foreground="{StaticResource MonitoringTextSecondaryBrush}"/>
                    </StackPanel>

                    <StackPanel Grid.Column="1" Orientation="Horizontal">
                        <ui:Button Content="+20pt" Appearance="Secondary" Margin="0,0,8,0"
                                   Click="OnDebugAddPointsClick" />

                        <ui:Button Content="ミニモード" Icon="{ui:SymbolIcon ArrowMinimize24}" 
                                   Appearance="Secondary" Click="OnToggleMiniModeClick" />

                        <ui:Button Content="終了" Appearance="Danger" Margin="8,0,0,0" 
                                   Click="OnStopSessionClick" />
                    </StackPanel>
                </Grid>
            </Border>
        </Grid>

        <Grid x:Name="MiniMonitorLayout" Width="180" Height="180" MouseLeftButtonDown="OnDragMoveWindow" Visibility="Collapsed">
            <Border Background="{StaticResource MonitoringBackgroundBrush}" CornerRadius="12" BorderBrush="{StaticResource MonitoringSurfaceStrokeBrush}" BorderThickness="1">
                <Grid ClipToBounds="True">

                    <Viewbox Margin="12">
                        <Grid x:Name="MiniMonitorContainer" Width="400" Height="400" RenderTransformOrigin="0.5,0.5">
                            <Grid.RenderTransform>
                                <TranslateTransform X="0" Y="0"/>
                            </Grid.RenderTransform>

                            <Grid Width="330" Height="330" HorizontalAlignment="Center" VerticalAlignment="Center">
                                <Grid.Clip>
                                    <EllipseGeometry Center="165,165" RadiusX="165" RadiusY="165"/>
                                </Grid.Clip>
                                <Border Background="{StaticResource MonitoringSolidBackgroundBrush}" />
                                <Border x:Name="MiniLiquidWater" 
                                        Height="330" Width="330"
                                        VerticalAlignment="Bottom"
                                        RenderTransformOrigin="0.5, 1">
                                    <Border.RenderTransform>
                                        <ScaleTransform x:Name="MiniLiquidScaleTransform" ScaleY="0" />
                                    </Border.RenderTransform>
                                </Border>
                            </Grid>

                            <Path x:Name="MiniArcPath" Stroke="{StaticResource MonitoringAccentBrush}" StrokeThickness="20" StrokeEndLineCap="Round">
                                <Path.Data>
                                    <PathGeometry>
                                        <PathFigure x:Name="MiniArcFigure" StartPoint="200,10">
                                            <ArcSegment x:Name="MiniArcSegment" Point="200,10" 
                                                        Size="190,190"
                                                        IsLargeArc="False"
                                                        SweepDirection="Clockwise" />
                                        </PathFigure>
                                    </PathGeometry>
                                </Path.Data>
                            </Path>
                        </Grid>
                    </Viewbox>

                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" IsHitTestVisible="False">
                        <TextBlock x:Name="MiniTimeDisplay" 
                                   FontSize="32" FontWeight="Bold" 
                                   Foreground="{StaticResource MonitoringTextPrimaryBrush}" HorizontalAlignment="Center">
                            <TextBlock.Effect>
                                <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.8"/>
                            </TextBlock.Effect>
                        </TextBlock>

                        <ui:SymbolIcon x:Name="MiniNextPenaltyIcon" Symbol="Alert24" 
                                       FontSize="24" Foreground="{StaticResource MonitoringTextPrimaryBrush}" 
                                       Margin="0,4,0,0">
                            <ui:SymbolIcon.Effect>
                                <DropShadowEffect Color="Black" BlurRadius="4" ShadowDepth="1" Opacity="0.8"/>
                            </ui:SymbolIcon.Effect>
                        </ui:SymbolIcon>
                    </StackPanel>

                    <ui:Button Icon="{ui:SymbolIcon ArrowMaximize24}" 
                               Click="OnToggleMiniModeClick"
                               Appearance="Transparent" 
                               HorizontalAlignment="Left" VerticalAlignment="Top"
                               Margin="8" Width="32" Height="32" Padding="0"
                               HorizontalContentAlignment="Center" VerticalContentAlignment="Center"
                               ToolTip="通常モードへ戻る"
                               Foreground="{StaticResource MonitoringTextTertiaryBrush}"/>
                </Grid>
            </Border>
        </Grid>
    </Grid>
</UserControl>
